<!DOCTYPE html>
<html>
    <head>
        <title>Math Test</title>
        <link rel="stylesheet" href = "scratch.css">
    </head>
    <body>
        <h3 class="header">ScratchCalc Basic Test</h3>
        <div class ="explanation">
            <p>This is an early preview of my new project.  Please experiment with it, 
                but know it is not a complete product yet,
            and has many known bugs and unimplemented features, and probably many unknown bugs
            and features I haven't thought of.  If you try it and see something that doesn't work
            that you think should work, please let me know by opening up an issue 
            <a href="https://bitbucket.org/scratchapps/scratchcalc/issues?status=new&status=open">here</a>.</p>
        </div>
        <div class="snapped">
            <div class="cursor"></div>
            <div class="in calcspace" rows="100">
                <div class="inln" data-line="1">123456</div>
                <div class="inln" data-line="2">123456</div>
                <div class="empty"></div>
            </div>
            <div class="out calcspace"></div>
        </div>
        <script type='text/javascript' src='ext/jquery.js'></script>
        <script type='text/javascript' src='ext/bigdecimal.js'></script>
        <script type='text/javascript' src='parser/tablePlaceHolder.js'></script>
        <script type='text/javascript' src='parser/eqTreeBuilder.js'></script>
        <script type='text/javascript' src='parser/eqTokenizer.js'></script>
        <script type='text/javascript' src='parser/eqScanner.js'></script>
        <script type='text/javascript' src='parser/eqParser.js'></script>
        <script type='text/javascript' src='parser/calcFramework.js'></script>
        <script type='text/javascript'>
            String.prototype.splice = function( idx, rem, s ) {
                return (this.slice(0,idx) + s + this.slice(idx + Math.abs(rem)));
            };
            calcFramework.addLine();
            var offset = $(".in").offset();
            var currentline = 1;
            var currentindex=0;
            $(".cursor").offset(offset);
            $(".empty").bind('click',function(e){
                //Take care of this later... for when we click below currentline

            });
            $(".inln").bind('click',function(e){
                currentline = $(e.currentTarget).data("line");
                var linelength = e.currentTarget.innerHTML.length;
                var xpos = e.pageX;
                var diff = xpos-offset.left;
                var pos = Math.min(linelength, diff/11|0);
                var output = pos ;
                $(".cursor").offset({ top:offset.top + (currentline-1)*25 , left: offset.left+(pos *11) });
                currentindex=pos;
            });

            $(document).keyup(function(e){
                var keyVal = String.fromCharCode(e.keyCode);
                var cline =  $('.inln').filter( function() { 
                    return $(this).data("line") == currentline; 
                });
                var input = cline.html()+"";
                input = input.splice(currentindex,0,keyVal);
                cline.html(input);
                var cursorOffset = $(".cursor").offset();
                cursorOffset.left += 11; 
                $(".cursor").offset(cursorOffset);  
                currentindex++;          
            });



            /*
            var typingTimer;                //timer identifier
            var doneTypingInterval = 0;  //time in ms, 5 second for example
            
            //on keyup, start the countdown
            $('.in').keyup(function(){
                typingTimer = setTimeout(doneTyping, doneTypingInterval);
            });

            //on keydown, clear the countdown 
            $('.in').keydown(function(){
                clearTimeout(typingTimer);
            });

            //user is "finished typing," do something
            function doneTyping() {
                var input = $('.in').val().split(/\r?\n/g);
                var output = input.map(EQParser.parse);
                var old = $('.out').html().split(/\n/g);
                $('.out').html("");
                output.forEach(function (str, idx) {
                    if (str !== "" || input[idx] === "") {
                        $('.out').append(
                            "<div class=\"outln\">" + str + "</div>\n");
                    }
                    else {
                        $('.out').append(old[idx]+"\n");
                    }
                    $('.out').scrollTop($('.in').scrollTop());
                });
            }

            $('.in').on('scroll', function () {
            $('.out').scrollTop($(this).scrollTop());
});
        (doneTyping());
        */
        </script>

    </body>
</html>